<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PRREPDD1F5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-PRREPDD1F5');
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <!-- Primary Meta Tags -->
  <title>Checkout â€” Complete Your Story Frames Order | Secure Payment</title>
  <meta name="title" content="Checkout â€” Complete Your Story Frames Order | Secure Payment" />
  <meta name="description" content="Complete your Story Frames order securely. Checkout with PayPal or credit card. Fast processing and instant confirmation for digital products." />
  <meta name="robots" content="noindex, nofollow" />
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://mystoryframes.shop/checkout.html" />
  
  <!-- Alternate Language Versions (hreflang) -->
  <link rel="alternate" hreflang="en" href="https://mystoryframes.shop/checkout.html?lang=en" />
  <link rel="alternate" hreflang="bg" href="https://mystoryframes.shop/checkout.html?lang=bg" />
  <link rel="alternate" hreflang="x-default" href="https://mystoryframes.shop/checkout.html" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://mystoryframes.shop/checkout.html" />
  <meta property="og:title" content="Checkout â€” Story Frames" />
  <meta property="og:description" content="Complete your Story Frames order securely with PayPal." />
  <meta property="og:image" content="https://mystoryframes.shop/logo.png" />
  <meta property="og:site_name" content="Story Frames" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:url" content="https://mystoryframes.shop/checkout.html" />
  <meta name="twitter:title" content="Checkout â€” Story Frames" />
  <meta name="twitter:description" content="Complete your Story Frames order securely with PayPal." />
  <meta name="twitter:image" content="https://mystoryframes.shop/logo.png" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="logo.png" />
  
  <link rel="stylesheet" href="styles.css">
  <script defer src="i18n.js"></script>
  <!-- PayPal SDK - supports both PayPal and card payments -->
  <script src="https://www.paypal.com/sdk/js?client-id=AZDxjDScFpQtjWTOUtWKbyN_bDt4OgqaF4eYXlewfBP4-8aqX3PiV8e1GWU6liB2CUed2TK-uhjVCt_b&currency=EUR&intent=capture"></script>
  
  <style>
    .checkout-container {
      max-width: 900px;
      margin: 20px auto;
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 20px;
      align-items: start;
    }
    
    .checkout-section {
      border: 1px solid var(--line);
      border-radius: 24px;
      background: rgba(255,255,255,.04);
      box-shadow: var(--shadow);
      padding: 24px;
    }
    
    .checkout-section h2 {
      margin: 0 0 20px;
      font-size: 24px;
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 700;
      color: var(--text);
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-size: 15px;
      font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: rgba(255,77,125,.55);
      background: rgba(255,255,255,.08);
    }
    
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .order-item {
      display: flex;
      gap: 12px;
      padding: 12px;
      margin-bottom: 10px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--line);
      border-radius: 14px;
      align-items: center;
    }
    
    .order-item-image {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      object-fit: cover;
      border: 1px solid var(--line);
    }
    
    .order-item-details {
      flex: 1;
    }
    
    .order-item-name {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 4px;
    }
    
    .order-item-price {
      color: var(--muted);
      font-size: 14px;
    }
    
    .order-summary-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      font-size: 15px;
    }
    
    .order-summary-row.total {
      border-top: 1px solid var(--line);
      margin-top: 10px;
      padding-top: 14px;
      font-size: 20px;
      font-weight: 900;
    }
    
    .empty-checkout {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    
    .payment-buttons {
      margin-top: 20px;
    }
    
    .cod-info {
      margin-top: 16px;
      padding: 14px;
      background: rgba(231,194,122,.12);
      border: 1px solid rgba(231,194,122,.35);
      border-radius: 14px;
      color: var(--text);
      font-size: 14px;
    }
    
    @media (max-width: 920px) {
      .checkout-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="toggleMobileMenu()"></div>
    
    <header class="top">
      <a class="brand" href="index.html">
        <div class="logo"><img src="logo.png" alt="Story Frames"></div>
        <div>
          <strong>Story Frames</strong>
          <small data-i18n="tagline">Crafting stories from photos</small>
        </div>
      </a>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <nav class="topnav" id="mobileNav">
        <a href="index.html" data-i18n="nav_home">Home</a>
        <a href="index.html#products" data-i18n="nav_products">Products</a>
        <a class="pill" href="https://facebook.com/Storyframesvarna/" target="_blank" rel="noopener noreferrer">Facebook</a>

        <div class="lang" aria-label="Language">
          <button class="langbtn" data-lang="en">EN</button>
          <button class="langbtn" data-lang="bg">BG</button>
        </div>
      </nav>
    </header>

    <main>
    <section style="margin-top: 20px;">
      <h1 data-i18n="checkout_title">Checkout</h1>
      <p data-i18n="checkout_subtitle" style="color:var(--muted);margin-top:8px;">Complete your order</p>
    </section>

    <div id="emptyCheckout" class="empty-checkout" style="display:none;">
      <div class="empty-cart-icon">ðŸ›’</div>
      <p data-i18n="cart_empty">Your cart is empty</p>
      <div class="actions" style="margin-top:16px;justify-content:center;">
        <a href="index.html#products" class="btn primary" data-i18n="continue_shopping">Continue Shopping</a>
      </div>
    </div>

    <div id="checkoutContainer" class="checkout-container">
      <!-- Customer Details Form -->
      <div class="checkout-section">
        <h2 data-i18n="customer_details">Customer Details</h2>
        <form id="checkout-form">
          <div class="form-group">
            <label for="fullName" data-i18n="full_name">Full Name</label>
            <input type="text" id="fullName" required>
          </div>
          
          <div class="form-group">
            <label for="email" data-i18n="email">Email Address</label>
            <input type="email" id="email" required>
          </div>
          
          <div class="form-group">
            <label for="phone" data-i18n="phone">Phone Number</label>
            <input type="tel" id="phone" required>
          </div>
          
          <div class="form-group">
            <label for="address" data-i18n="address">Shipping Address</label>
            <input type="text" id="address" required>
          </div>
          
          <div class="form-group">
            <label for="city" data-i18n="city">City</label>
            <input type="text" id="city" required>
          </div>
          
          <div class="form-group">
            <label for="postalCode" data-i18n="postal_code">Postal Code</label>
            <input type="text" id="postalCode">
          </div>
          
          <div class="form-group">
            <label for="country" data-i18n="country">Country</label>
            <select id="country" required>
              <option value="BG">Bulgaria</option>
              <option value="Other">Other</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="notes" data-i18n="order_notes">Order Notes (Optional)</label>
            <textarea id="notes" data-i18n="order_notes_placeholder" placeholder="Special instructions, delivery preferences, etc."></textarea>
          </div>
        </form>
      </div>

      <!-- Order Summary -->
      <div class="checkout-section">
        <h2 data-i18n="order_summary">Order Summary</h2>
        <div id="orderItems"></div>
        
        <div style="margin-top: 16px;">
          <div class="order-summary-row">
            <span data-i18n="subtotal">Subtotal:</span>
            <span id="orderSubtotal">â‚¬0.00</span>
          </div>
          <div class="order-summary-row total">
            <span data-i18n="total">Total:</span>
            <span id="orderTotal">â‚¬0.00</span>
          </div>
        </div>
        
        <div class="payment-buttons">
          <h3 style="font-size:18px;margin:0 0 12px;" data-i18n="payment_method">Payment Method</h3>
          
          <!-- PayPal Buttons (supports card payments) -->
          <div id="paypal-button-container"></div>
          <p class="payment-info-note" data-i18n="card_payment_note">ðŸ’³ PayPal also accepts credit and debit cards</p>
          
          <!-- COD Button for Bulgaria - Large and Prominent -->
          <div id="codButton" style="display:none;">
            <button class="btn-order-cta btn-order-cta-full" onclick="submitCODOrder()" data-i18n="buy_cod_checkout">Bulgaria COD</button>
            <div class="cod-info">
              ðŸ’¡ <span data-i18n="cod_info_text">Cash on Delivery available for Bulgaria orders only. We'll contact you to confirm delivery details.</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  </main>

  <footer>
    <div>Â© <span id="year"></span> Story Frames</div>
    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <a href="mailto:Sviievmla@gmail.com">Sviievmla@gmail.com</a>
      <a href="https://facebook.com/Storyframesvarna/" target="_blank" rel="noopener noreferrer">Facebook</a>
    </div>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // Mobile Menu Toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('mobileNav');
      const toggle = document.getElementById('mobileMenuToggle');
      const overlay = document.getElementById('mobileMenuOverlay');
      
      nav.classList.toggle('active');
      toggle.classList.toggle('active');
      overlay.classList.toggle('active');
      
      if (nav.classList.contains('active')) {
        document.body.style.overflow = 'hidden';
      } else {
        document.body.style.overflow = '';
      }
    }
    
    // Close mobile menu when clicking on a link
    document.querySelectorAll('#mobileNav a').forEach(link => {
      link.addEventListener('click', function(e) {
        // Don't close for cart icon since it opens a modal
        if (!this.classList.contains('cart-icon')) {
          const nav = document.getElementById('mobileNav');
          const toggle = document.getElementById('mobileMenuToggle');
          const overlay = document.getElementById('mobileMenuOverlay');
          
          nav.classList.remove('active');
          toggle.classList.remove('active');
          overlay.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
    });
    
    // Load cart from localStorage
    let cart = JSON.parse(localStorage.getItem('storyframesCart') || '[]');
    
    function displayCheckout() {
      const emptyCheckout = document.getElementById('emptyCheckout');
      const checkoutContainer = document.getElementById('checkoutContainer');
      const orderItems = document.getElementById('orderItems');
      const orderSubtotal = document.getElementById('orderSubtotal');
      const orderTotal = document.getElementById('orderTotal');
      const codButton = document.getElementById('codButton');
      
      if (cart.length === 0) {
        emptyCheckout.style.display = 'block';
        checkoutContainer.style.display = 'none';
        return;
      }
      
      emptyCheckout.style.display = 'none';
      checkoutContainer.style.display = 'grid';
      
      // Display order items
      orderItems.innerHTML = cart.map(item => {
        const quantity = item.quantity || 1;
        const itemTotal = item.price * quantity;
        return `
          <div class="order-item">
            <img src="${item.image}" alt="${item.name}" class="order-item-image">
            <div class="order-item-details">
              <div class="order-item-name">${item.name}</div>
              <div class="order-item-price">â‚¬${item.price.toFixed(2)} Ã— ${quantity} = â‚¬${itemTotal.toFixed(2)}</div>
            </div>
          </div>
        `;
      }).join('');
      
      // Calculate totals
      const subtotal = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
      const total = subtotal;
      
      orderSubtotal.textContent = `â‚¬${subtotal.toFixed(2)}`;
      orderTotal.textContent = `â‚¬${total.toFixed(2)}`;
      
      // Show COD button if Bulgaria is selected
      const countrySelect = document.getElementById('country');
      if (countrySelect) {
        countrySelect.addEventListener('change', function() {
          codButton.style.display = this.value === 'BG' ? 'block' : 'none';
        });
        // Initial check
        codButton.style.display = countrySelect.value === 'BG' ? 'block' : 'none';
      }
      
      // Render PayPal buttons
      renderPayPalButtons(total);
    }
    
    function renderPayPalButtons(total) {
      const container = document.getElementById('paypal-button-container');
      if (!container || cart.length === 0) return;
      
      paypal.Buttons({
        style: {
          layout: 'vertical',
          color: 'gold',
          shape: 'rect',
          label: 'paypal'
        },
        
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
              description: 'Story Frames Order',
              amount: {
                currency_code: 'EUR',
                value: total.toFixed(2),
                breakdown: {
                  item_total: {
                    currency_code: 'EUR',
                    value: total.toFixed(2)
                  }
                }
              },
              items: cart.map(item => ({
                name: item.name,
                unit_amount: {
                  currency_code: 'EUR',
                  value: item.price.toFixed(2)
                },
                quantity: String(item.quantity || 1)
              }))
            }]
          });
        },
        
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            // Get customer details
            const customerInfo = getCustomerInfo();
            
            // Send confirmation email
            sendOrderEmail(details, customerInfo);
            
            // Clear cart
            localStorage.removeItem('storyframesCart');
            
            // Show success message
            alert('Payment successful! Order ID: ' + details.id + '\n\nThank you, ' + details.payer.name.given_name + '!\n\nWe will send you an email confirmation shortly.');
            
            // Redirect to home
            window.location.href = 'index.html';
          });
        },
        
        onError: function(err) {
          console.error('PayPal error:', err);
          alert('An error occurred during payment. Please try again.');
        }
      }).render('#paypal-button-container');
    }
    
    function getCustomerInfo() {
      return {
        fullName: document.getElementById('fullName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        city: document.getElementById('city').value,
        postalCode: document.getElementById('postalCode').value,
        country: document.getElementById('country').value,
        notes: document.getElementById('notes').value
      };
    }
    
    function submitCODOrder() {
      const form = document.getElementById('checkout-form');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      const customerInfo = getCustomerInfo();
      const itemsList = cart.map(item => `${item.name} Ã— ${item.quantity || 1} - â‚¬${(item.price * (item.quantity || 1)).toFixed(2)}`).join('\n');
      const total = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
      
      const subject = 'Story Frames COD Order';
      const body = [
        'New COD Order (Bulgaria)',
        '',
        'Customer Details:',
        `Name: ${customerInfo.fullName}`,
        `Email: ${customerInfo.email}`,
        `Phone: ${customerInfo.phone}`,
        `Address: ${customerInfo.address}`,
        `City: ${customerInfo.city}`,
        `Postal Code: ${customerInfo.postalCode}`,
        '',
        'Items Ordered:',
        itemsList,
        '',
        `Total: â‚¬${total.toFixed(2)}`,
        '',
        'Order Notes:',
        customerInfo.notes || 'None',
        '',
        'Please confirm delivery details.'
      ].join('\n');
      
      window.location.href = `mailto:Sviievmla@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      
      // Clear cart after sending
      setTimeout(() => {
        localStorage.removeItem('storyframesCart');
        alert('Your COD order has been sent! We will contact you shortly to confirm delivery details.');
        window.location.href = 'index.html';
      }, 1000);
    }
    
    function sendOrderEmail(details, customerInfo) {
      const itemsList = cart.map(item => `${item.name} Ã— ${item.quantity || 1} - â‚¬${(item.price * (item.quantity || 1)).toFixed(2)}`).join('\n');
      const total = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
      
      const subject = 'Story Frames Order Confirmation - ' + details.id;
      const body = [
        'Order Confirmation',
        '',
        'Transaction ID: ' + details.id,
        '',
        'Customer Details:',
        `Name: ${customerInfo.fullName}`,
        `Email: ${customerInfo.email}`,
        `Phone: ${customerInfo.phone}`,
        `Address: ${customerInfo.address}, ${customerInfo.city}`,
        `Postal Code: ${customerInfo.postalCode}`,
        `Country: ${customerInfo.country}`,
        '',
        'Items Ordered:',
        itemsList,
        '',
        `Total Paid: â‚¬${total.toFixed(2)}`,
        '',
        'Order Notes:',
        customerInfo.notes || 'None',
        '',
        'Please send your photos to complete the order.'
      ].join('\n');
      
      window.open(`mailto:Sviievmla@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`, '_blank');
    }
    
    // Initialize checkout on page load
    displayCheckout();
  </script>
</body>
</html>